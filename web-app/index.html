<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tourist Attraction Media Showcase</title>
    <style>
        /* Simple CSS for styling */
        body { font-family: Arial, sans-serif; padding: 20px; }
        .gallery { display: flex; flex-wrap: wrap; gap: 15px; }
        .image-item { width: 200px; text-align: center; }
        img { width: 100%; height: auto; }
    </style>
</head>
<body>

    <h1>Tourist Attraction Media Showcase</h1>

    <!-- File upload section -->
    <div>
        <h2>Upload Media File</h2>
        <input type="file" id="mediaFile" />
        <input type="text" id="location" placeholder="Enter location" />
        <button onclick="uploadFile()">Upload</button>
    </div>

    <hr />

    <!-- Gallery display -->
    <div>
        <h2>Gallery</h2>
        <div class="gallery" id="gallery">
            <!-- Media files will be displayed here -->
        </div>
    </div>

    <script>
        // Azure Function API URL
        const functionUrl = 'https://touristfunctionapi.azurewebsites.net/api/TouristAttractionMedia';

        // Upload Media Function
        async function uploadFile() {
            const fileInput = document.getElementById('mediaFile');
            const locationInput = document.getElementById('location');

            const formData = new FormData();
            formData.append('mediaFile', fileInput.files[0]);
            formData.append('location', locationInput.value);

            try {
                const response = await fetch(functionUrl, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    alert('File uploaded successfully!');
                    fetchGallery(); // Refresh the gallery
                } else {
                    alert(`Error: ${result.body}`);
                }
            } catch (error) {
                console.error('Error uploading file:', error);
            }
        }

        // Fetch Gallery
        async function fetchGallery() {
            try {
                const response = await fetch(functionUrl, { method: 'GET' });
                const mediaFiles = await response.json();

                const galleryContainer = document.getElementById('gallery');
                galleryContainer.innerHTML = ''; // Clear the gallery

                mediaFiles.forEach(media => {
                    const mediaElement = document.createElement('div');
                    mediaElement.className = 'image-item';
                    mediaElement.innerHTML = `
                        <img src="${media.url}" alt="${media.name}" />
                        <button onclick="deleteFile('${media.name}')">Delete</button>
                    `;
                    galleryContainer.appendChild(mediaElement);
                });
            } catch (error) {
                console.error('Error fetching gallery:', error);
            }
        }

        // Delete Media File
        async function deleteFile(blobName) {
            const response = await fetch(`${functionUrl}?blobName=${blobName}`, { method: 'DELETE' });

            const result = await response.json();
            if (response.ok) {
                alert(`Deleted file: ${blobName}`);
                fetchGallery(); // Refresh the gallery
            } else {
                alert(`Error: ${result.body}`);
            }
        }

        // Load the gallery initially
        fetchGallery();
    </script>

    <script src="app.js"></script>
</body>

</html>
